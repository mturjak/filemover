<!DOCTYPE html>
<html>
<head>
 	<meta charset="utf-8">
  <title>mturjak/filemover - demo</title>
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
 	<link rel="stylesheet" type="text/css" href="css/demo.css">
 	<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
  <script src="js/jquery.filemover.min.js"></script>
</head>
<body>
 	<header class="main-header">
 		<h1>Demo - <a href="https://github.com/mturjak/filemover">mturjak/filemover</a></h1>
 	</header>
 	<section id="main-content">
 	<div class="console alert alert-info">
    <p><strong>Console ...</strong></p>
  </div>
  <h3><i class="glyphicon glyphicon-folder-open lightgray"></i> files/</h3>
 	<ul id="f1" class="file-list">
    <li><button class="move btn btn-primary btn-sm" data-origin="" data-target="test" data-tid="#f2">MOVE TO: files/test/</button></li>
 	</ul>
  <h3><i class="glyphicon glyphicon-folder-open lightgray"></i> <span class="lightgray">files/</span>test/</h3>
  <ul id="f2" class="file-list">
    <li><button class="move btn btn-primary btn-sm" data-origin="test" data-target="" data-tid="#f1">MOVE TO: files/</button></li>
  </ul>
	</section>
 	<footer>
 	</footer>
  <script type="text/javascript">
    function listFiles(obj, dir) {
      $.ajax({
        url: 'server/php/index.php',
        data: {'dir': dir },
        dataType: 'json',
        type: 'POST'
      }).done(function(res){
        $.each(res.files, function(){
          $('<li class="file" data-fname="'
            +( dir == '' ? '' : dir+'/')
            +this+'"><label><input class="to_move" type="checkbox" /> '
            +this+'</label></li>').prependTo(obj);
        });
      });
    }
    $(function(){
      $('.file-list').each(function(i){
        listFiles(this,$(this).find('button.move').data('origin'));
      });
      $('.file-list').on('change', 'input.to_move', function(){
        $(this).parent().parent().toggleClass('selected');
      });
      $('.move').on('click', function(){
        var origin = ( $(this).data('origin') == '' ? '' : $(this).data('origin') + '/'),
            target = $(this).data('target'),
            targetId = $(this).data('tid');
        $(this).parent().siblings('li.selected').filemover( target, function(obj, res){
          $('.console').html('');
          $.each( res, function(i){
            $('.console').append( "<p>"+this.message+"</p>" );
            if( this.done ) {
              var fn = $(obj[i]).data('fname').replace( origin, '' );
              $(obj[i]).data('fname', target + '/' + fn).prependTo(targetId);
            }
          });
        });
      });
    });
  </script>
</body>
</html>